<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Animation state machines - The Machinery Book</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../../favicon.svg">
                        <link rel="shortcut icon" href="../../favicon.png">
                <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
                <link rel="stylesheet" href="../../css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../index.html"><strong aria-hidden="true">1.</strong> Welcome</a></li><li class="chapter-item expanded "><a href="../../what_is_the_machinery.html"><strong aria-hidden="true">2.</strong> What is The Machinery</a></li><li class="chapter-item expanded "><a href="../../licenses.html"><strong aria-hidden="true">3.</strong> Licenses</a></li><li class="chapter-item expanded "><a href="../../getting_started/index.html"><strong aria-hidden="true">4.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../getting_started/what_is_in_the_package.html"><strong aria-hidden="true">4.1.</strong> What is in this package</a></li><li class="chapter-item expanded "><a href="../../getting_started/logging_in.html"><strong aria-hidden="true">4.2.</strong> Sign In</a></li><li class="chapter-item expanded "><a href="../../getting_started/new_project.html"><strong aria-hidden="true">4.3.</strong> New Project</a></li><li class="chapter-item expanded "><a href="../../getting_started/first_gameplay_project.html"><strong aria-hidden="true">4.4.</strong> First Gameplay Project</a></li><li class="chapter-item expanded "><a href="../../getting_started/sample-projects.html"><strong aria-hidden="true">4.5.</strong> Sample Projects</a></li><li class="chapter-item expanded "><a href="../../getting_started/troubleshooting.html"><strong aria-hidden="true">4.6.</strong> Troubleshooting</a></li><li class="chapter-item expanded "><a href="../../getting_started/migration_from_unity.html"><strong aria-hidden="true">4.7.</strong> The Machinery for Unity Dev's</a></li><li class="chapter-item expanded "><a href="../../getting_started/migration_from_unreal.html"><strong aria-hidden="true">4.8.</strong> The Machinery for Unreal 4 Dev's</a></li></ol></li><li class="chapter-item expanded "><a href="../../the_editor/index.html"><strong aria-hidden="true">5.</strong> The Editor</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../the_editor/tabs.html"><strong aria-hidden="true">5.1.</strong> About Tabs</a></li><li class="chapter-item expanded "><a href="../../the_editor/entity_tree_tab.html"><strong aria-hidden="true">5.2.</strong> Entity Tree Tab</a></li><li class="chapter-item expanded "><a href="../../the_editor/scene_tab.html"><strong aria-hidden="true">5.3.</strong> Scene Tab</a></li><li class="chapter-item expanded "><a href="../../the_editor/properties_tab.html"><strong aria-hidden="true">5.4.</strong> Properties Tab</a></li><li class="chapter-item expanded "><a href="../../the_editor/asset_browser.html"><strong aria-hidden="true">5.5.</strong> Asset Browser</a></li><li class="chapter-item expanded "><a href="../../the_editor/simulate_tab.html"><strong aria-hidden="true">5.6.</strong> Simulate Tab</a></li><li class="chapter-item expanded "><a href="../../the_editor/preview_tab.html"><strong aria-hidden="true">5.7.</strong> Preview Tab</a></li></ol></li><li class="chapter-item expanded "><a href="../../editing_workflows/index.html"><strong aria-hidden="true">6.</strong> Editing Workflows</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../editing_workflows/entities.html"><strong aria-hidden="true">6.1.</strong> Entities</a></li><li class="chapter-item expanded "><a href="../../editing_workflows/creation_graphs_asset_pipeline.html"><strong aria-hidden="true">6.2.</strong> Creation graphs and asset pipeline</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../editing_workflows/import_assets.html"><strong aria-hidden="true">6.2.1.</strong> Importing Assets</a></li></ol></li><li class="chapter-item expanded "><a href="../../editing_workflows/prototypes.html"><strong aria-hidden="true">6.3.</strong> Prototypes</a></li><li class="chapter-item expanded "><a href="../../editing_workflows/simulation.html"><strong aria-hidden="true">6.4.</strong> Simulation</a></li><li class="chapter-item expanded "><a href="../../editing_workflows/visual-scripting.html"><strong aria-hidden="true">6.5.</strong> Visual Scripting: Entity Graphs</a></li><li class="chapter-item expanded "><a href="../../editing_workflows/physics.html"><strong aria-hidden="true">6.6.</strong> Physics</a></li><li class="chapter-item expanded "><a href="../../editing_workflows/animation/index.html"><strong aria-hidden="true">6.7.</strong> Animation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../editing_workflows/animation/animation-state-machine.html" class="active"><strong aria-hidden="true">6.7.1.</strong> Animation state machines</a></li></ol></li><li class="chapter-item expanded "><a href="../../editing_workflows/sound.html"><strong aria-hidden="true">6.8.</strong> Sound</a></li><li class="chapter-item expanded "><a href="../../editing_workflows/publish.html"><strong aria-hidden="true">6.9.</strong> Publish</a></li></ol></li><li class="chapter-item expanded "><a href="../../collaboration.html"><strong aria-hidden="true">7.</strong> Collaboration</a></li><li class="chapter-item expanded "><a href="../../the_truth/index.html"><strong aria-hidden="true">8.</strong> The Truth</a></li><li class="chapter-item expanded "><a href="../../extending_the_machinery/index.html"><strong aria-hidden="true">9.</strong> Extending The Machinery</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../extending_the_machinery/the_plugin_system.html"><strong aria-hidden="true">9.1.</strong> The Plugin System</a></li><li class="chapter-item expanded "><a href="../../extending_the_machinery/hot-reloading.html"><strong aria-hidden="true">9.2.</strong> Hot-reloading</a></li><li class="chapter-item expanded "><a href="../../extending_the_machinery/plugin-assets.html"><strong aria-hidden="true">9.3.</strong> Plugin assets</a></li><li class="chapter-item expanded "><a href="../../extending_the_machinery/write-a-plugin.html"><strong aria-hidden="true">9.4.</strong> Writing a plugin</a></li><li class="chapter-item expanded "><a href="../../the_truth/custom_truth_type.html"><strong aria-hidden="true">9.5.</strong> Create a custom Truth Type</a></li></ol></li><li class="chapter-item expanded "><a href="../../gameplay_coding/index.html"><strong aria-hidden="true">10.</strong> Gameplay coding</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../gameplay_coding/simulate_entry.html"><strong aria-hidden="true">10.1.</strong> Simulate Entry in C</a></li><li class="chapter-item expanded "><a href="../../gameplay_coding/extend_the_visual_scripting_language.html"><strong aria-hidden="true">10.2.</strong> Extending the visual scripting language</a></li><li class="chapter-item expanded "><a href="../../gameplay_coding/ecs/index.html"><strong aria-hidden="true">10.3.</strong> Entity Component System</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../gameplay_coding/ecs/write_a_custom_component.html"><strong aria-hidden="true">10.3.1.</strong> Write a custom component</a></li><li class="chapter-item expanded "><a href="../../gameplay_coding/ecs/write_a_system_or_engine.html"><strong aria-hidden="true">10.3.2.</strong> Write a Systems &amp; Engines</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../qa_pipeline/index.html"><strong aria-hidden="true">11.</strong> QA Pipeline</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../qa_pipeline/how_to_write_unit_tests.html"><strong aria-hidden="true">11.1.</strong> Write your own unit tests</a></li><li class="chapter-item expanded "><a href="../../qa_pipeline/how_to_write_integration_tests.html"><strong aria-hidden="true">11.2.</strong> Write your own integration tests</a></li></ol></li><li class="chapter-item expanded "><a href="../../helper_tools/index.html"><strong aria-hidden="true">12.</strong> Helper Tools</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../helper_tools/tmbuild.html"><strong aria-hidden="true">12.1.</strong> How to use tmbuild</a></li><li class="chapter-item expanded "><a href="../../helper_tools/hash.html"><strong aria-hidden="true">12.2.</strong> How to use hash</a></li></ol></li><li class="chapter-item expanded "><a href="../../writing_an_executable.html"><strong aria-hidden="true">13.</strong> Writing an executable</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">The Machinery Book</h1>

                    <div class="right-buttons">
                                                <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        <a href="https://github.com/OurMachinery/themachinery-books" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                                                
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h3 id="animation-state-machines"><a class="header" href="#animation-state-machines">Animation state machines</a></h3>
<p>The <em>Animation State Machine Asset</em> represents an <em>Animation State Machine</em>. If you double-click an
Animation State Machine Asset in the Asset Browser, an Animation State Machine Editor will open:</p>
<p><img src="https://www.dropbox.com/s/fdte16tqekqhev6/asm-editor.png?dl=1" alt="Animation State Machine Editor" /></p>
<p>The Animation State Machine (ASM) introduces a number of concepts: <em>Layers</em>, <em>States</em>,
<em>Transitions</em>, <em>Events</em>, <em>Variables</em>, and <em>Blend Sets</em>.</p>
<p>The ASM represents a complex animation setup with multiple animations that can be played on a
character by dividing it into <em>States</em>. Each state represents something the character is doing
(running, walking, swimming, jumping, etc) and in each state, one particular animation, or a
particular blend of animations is being played. The states are the boxes in the <em>State Graph</em>.</p>
<p>The ASM can change state by taking a <em>Transition</em> from one state to another. The transitions are
represented by arrows in the graph. When the transition is taken, the animation crossfades over from
the animations in one state to the animations in the other state. The properties of the transition
specify the crossfade time. Note that even though the crossfade takes some time, the logical <em>state
transition</em> is immediate. I.e. as soon as the transition is taken, the state machine will logically
be in the new state.</p>
<p>The transitions are triggered by <em>Events</em>. An event is simply a named thing that can be sent to the
ASM from gameplay code. For example, the gameplay may send a &quot;jump&quot; event and that triggers the
animation to transition to the &quot;jump&quot; state.</p>
<p><em>Variables</em> are float values that can be set from gameplay code to affect how the animations play.
The variables can be used in the states to affect their playback. For example, you may create a
variable called <code>run_speed</code> and set the playback <em>Speed</em> of your <em>run</em> state to be <code>run_speed</code>.
That way, gameplay can control the speed of the animation.</p>
<p>Note that the <em>Speed</em> of a state can be set to a fixed number, a variable, or a mathematical
expression using variables and numbers. (E.g. <code>run_speed * 2</code>.) We have a small expression language
that we use to evaluate these expressions.</p>
<p>The ASM supports multiple <em>Layers</em> of state graphs. This works similar to image layering in an
application such as Photoshop. Animations in &quot;higher&quot; layers will be played &quot;on top&quot; of animations
in the lower layers and hide them.</p>
<p>As an example of how to use layering, you could have a bottom layer that controls the player's basic
locomotion (walking, running, etc). Then you could have a second layer on top of that for
controlling arm movements. That way, you could play a reload animation on the arms while the legs
are still running. Finally, you could have a top layer to play &quot;hurt&quot; animations when the player for
example gets hit by a bullet. These hurt animations could then interrupt the reload animations
whenever the player got hit.</p>
<p><em>Blend Sets</em> can be used to control the per-bone opacity of animations playing in higher layers.
They simply specify a weight for each bone. In the example above, the animations in the &quot;arm
movement&quot; layer would have opacity 1.0 for all arm bones, but 0.0 for all leg bones. That way, they
would hide the arm movement from the running animation below, but let the leg movement show through.</p>
<p>The Animation State Machine Editor has a <em>Tree View</em> to the left that lets you browse all the
layers, states, transitions, events, variables, and blend sets. The <em>State Graph</em> lets you edit the
states and transitions in the current layer. The <em>Properties</em> window lets you set the properties of
the currently selected objects and the <em>Preview</em> shows you a preview of what the animation looks
like. Note that for the preview to work, you must specify a <em>Preview Entity</em> in the properties of
the state machine. This is the entity that will be used to preview the ASM. When you select a state
in the <em>State Graph</em>, the preview will update to show that state.</p>
<p>In the <em>Preview</em> window, you also find the <em>Motion Mixer</em>. This allows you to send events to the ASM
and change variables to see how the animation reacts.</p>
<p>The ASM currently supports the following animation states:</p>
<p><strong>Regular State</strong></p>
<p>Plays a regular animation.</p>
<p><strong>Random State</strong></p>
<p>Randomly plays an animation out of a set of options.</p>
<p><strong>Empty State</strong></p>
<p>A state that doesn't play any animation at all. Note that this state is only useful in higher layers.
You can transition to an empty state to &quot;clear&quot; the animation in the layer and let the animations from
the layers below it shine through.</p>
<p><strong>Blend State</strong></p>
<p>Allows you to make a 1D or 2D blend between animations based on the value of variables. This is often
used for locomotion. You can use different animations based on the characters running speed and whether
the character is turning left or right and position them on a map to blend between them.</p>
<p><img src="https://www.dropbox.com/s/p9yc7qyoaml4l70/animation-blending.png?dl=1" alt="Animation Blending" /></p>
<p>Once you have created an Animation State Machine, you can assign it to a character by giving it an
Animation State Machine Component.</p>
<p>For an example of how the animation system works, have a look at the <code>mannequin</code> sample project.</p>
<h3 id="missing-features"><a class="header" href="#missing-features">Missing features</a></h3>
<p>Note that the animation system is still under active development. Here are some features that are
planned for the near future:</p>
<ul>
<li>Ragdolls.</li>
<li>Animation compression.</li>
<li>Triggers.</li>
<li>More animation states.
<ul>
<li>Offset State.</li>
<li>Template State.</li>
<li>Expression-based Blend State.</li>
<li>Graph-based Blend State.</li>
</ul>
</li>
<li>Beat transitions.</li>
<li>Constraints.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="../../editing_workflows/animation/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="../../editing_workflows/sound.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="../../editing_workflows/animation/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="../../editing_workflows/sound.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
