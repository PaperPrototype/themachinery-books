<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The Plugin System - The Machinery Book</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../favicon.svg">
                        <link rel="shortcut icon" href="../favicon.png">
                <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
                <link rel="stylesheet" href="../css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../index.html"><strong aria-hidden="true">1.</strong> Welcome</a></li><li class="chapter-item expanded "><a href="../what_is_the_machinery.html"><strong aria-hidden="true">2.</strong> What is The Machinery</a></li><li class="chapter-item expanded "><a href="../licenses.html"><strong aria-hidden="true">3.</strong> Licenses</a></li><li class="chapter-item expanded "><a href="../getting_started/index.html"><strong aria-hidden="true">4.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../getting_started/what_is_in_the_package.html"><strong aria-hidden="true">4.1.</strong> What is in this package</a></li><li class="chapter-item expanded "><a href="../getting_started/logging_in.html"><strong aria-hidden="true">4.2.</strong> Sign In</a></li><li class="chapter-item expanded "><a href="../getting_started/new_project.html"><strong aria-hidden="true">4.3.</strong> New Project</a></li><li class="chapter-item expanded "><a href="../getting_started/first_gameplay_project.html"><strong aria-hidden="true">4.4.</strong> First Gameplay Project</a></li><li class="chapter-item expanded "><a href="../getting_started/sample-projects.html"><strong aria-hidden="true">4.5.</strong> Sample Projects</a></li><li class="chapter-item expanded "><a href="../getting_started/troubleshooting.html"><strong aria-hidden="true">4.6.</strong> Troubleshooting</a></li><li class="chapter-item expanded "><a href="../getting_started/migration_from_unity.html"><strong aria-hidden="true">4.7.</strong> The Machinery for Unity Dev's</a></li><li class="chapter-item expanded "><a href="../getting_started/migration_from_unreal.html"><strong aria-hidden="true">4.8.</strong> The Machinery for Unreal 4 Dev's</a></li></ol></li><li class="chapter-item expanded "><a href="../the_editor/index.html"><strong aria-hidden="true">5.</strong> The Editor</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../the_editor/tabs.html"><strong aria-hidden="true">5.1.</strong> About Tabs</a></li><li class="chapter-item expanded "><a href="../the_editor/entity_tree_tab.html"><strong aria-hidden="true">5.2.</strong> Entity Tree Tab</a></li><li class="chapter-item expanded "><a href="../the_editor/scene_tab.html"><strong aria-hidden="true">5.3.</strong> Scene Tab</a></li><li class="chapter-item expanded "><a href="../the_editor/properties_tab.html"><strong aria-hidden="true">5.4.</strong> Properties Tab</a></li><li class="chapter-item expanded "><a href="../the_editor/asset_browser.html"><strong aria-hidden="true">5.5.</strong> Asset Browser</a></li><li class="chapter-item expanded "><a href="../the_editor/simulate_tab.html"><strong aria-hidden="true">5.6.</strong> Simulate Tab</a></li><li class="chapter-item expanded "><a href="../the_editor/preview_tab.html"><strong aria-hidden="true">5.7.</strong> Preview Tab</a></li></ol></li><li class="chapter-item expanded "><a href="../editing_workflows/index.html"><strong aria-hidden="true">6.</strong> Editing Workflows</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../editing_workflows/entities.html"><strong aria-hidden="true">6.1.</strong> Entities</a></li><li class="chapter-item expanded "><a href="../editing_workflows/creation_graphs_asset_pipeline.html"><strong aria-hidden="true">6.2.</strong> Creation graphs and asset pipeline</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../editing_workflows/import_assets.html"><strong aria-hidden="true">6.2.1.</strong> Importing Assets</a></li></ol></li><li class="chapter-item expanded "><a href="../editing_workflows/prototypes.html"><strong aria-hidden="true">6.3.</strong> Prototypes</a></li><li class="chapter-item expanded "><a href="../editing_workflows/simulation.html"><strong aria-hidden="true">6.4.</strong> Simulation</a></li><li class="chapter-item expanded "><a href="../editing_workflows/visual-scripting.html"><strong aria-hidden="true">6.5.</strong> Visual Scripting: Entity Graphs</a></li><li class="chapter-item expanded "><a href="../editing_workflows/physics.html"><strong aria-hidden="true">6.6.</strong> Physics</a></li><li class="chapter-item expanded "><a href="../editing_workflows/animation/index.html"><strong aria-hidden="true">6.7.</strong> Animation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../editing_workflows/animation/animation-state-machine.html"><strong aria-hidden="true">6.7.1.</strong> Animation state machines</a></li></ol></li><li class="chapter-item expanded "><a href="../editing_workflows/sound.html"><strong aria-hidden="true">6.8.</strong> Sound</a></li><li class="chapter-item expanded "><a href="../editing_workflows/publish.html"><strong aria-hidden="true">6.9.</strong> Publish</a></li></ol></li><li class="chapter-item expanded "><a href="../collaboration.html"><strong aria-hidden="true">7.</strong> Collaboration</a></li><li class="chapter-item expanded "><a href="../the_truth/index.html"><strong aria-hidden="true">8.</strong> The Truth</a></li><li class="chapter-item expanded "><a href="../extending_the_machinery/index.html"><strong aria-hidden="true">9.</strong> Extending The Machinery</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../extending_the_machinery/the_plugin_system.html" class="active"><strong aria-hidden="true">9.1.</strong> The Plugin System</a></li><li class="chapter-item expanded "><a href="../extending_the_machinery/hot-reloading.html"><strong aria-hidden="true">9.2.</strong> Hot-reloading</a></li><li class="chapter-item expanded "><a href="../extending_the_machinery/plugin-assets.html"><strong aria-hidden="true">9.3.</strong> Plugin assets</a></li><li class="chapter-item expanded "><a href="../extending_the_machinery/write-a-plugin.html"><strong aria-hidden="true">9.4.</strong> Writing a plugin</a></li><li class="chapter-item expanded "><a href="../the_truth/custom_truth_type.html"><strong aria-hidden="true">9.5.</strong> Create a custom Truth Type</a></li></ol></li><li class="chapter-item expanded "><a href="../gameplay_coding/index.html"><strong aria-hidden="true">10.</strong> Gameplay coding</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../gameplay_coding/simulate_entry.html"><strong aria-hidden="true">10.1.</strong> Simulate Entry in C</a></li><li class="chapter-item expanded "><a href="../gameplay_coding/extend_the_visual_scripting_language.html"><strong aria-hidden="true">10.2.</strong> Extending the visual scripting language</a></li><li class="chapter-item expanded "><a href="../gameplay_coding/ecs/index.html"><strong aria-hidden="true">10.3.</strong> Entity Component System</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../gameplay_coding/ecs/write_a_custom_component.html"><strong aria-hidden="true">10.3.1.</strong> Write a custom component</a></li><li class="chapter-item expanded "><a href="../gameplay_coding/ecs/write_a_system_or_engine.html"><strong aria-hidden="true">10.3.2.</strong> Write a Systems &amp; Engines</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../qa_pipeline/index.html"><strong aria-hidden="true">11.</strong> QA Pipeline</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../qa_pipeline/how_to_write_unit_tests.html"><strong aria-hidden="true">11.1.</strong> Write your own unit tests</a></li><li class="chapter-item expanded "><a href="../qa_pipeline/how_to_write_integration_tests.html"><strong aria-hidden="true">11.2.</strong> Write your own integration tests</a></li></ol></li><li class="chapter-item expanded "><a href="../helper_tools/index.html"><strong aria-hidden="true">12.</strong> Helper Tools</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../helper_tools/tmbuild.html"><strong aria-hidden="true">12.1.</strong> How to use tmbuild</a></li><li class="chapter-item expanded "><a href="../helper_tools/hash.html"><strong aria-hidden="true">12.2.</strong> How to use hash</a></li></ol></li><li class="chapter-item expanded "><a href="../writing_an_executable.html"><strong aria-hidden="true">13.</strong> Writing an executable</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">The Machinery Book</h1>

                    <div class="right-buttons">
                                                <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="the-plugin-system"><a class="header" href="#the-plugin-system">The plugin system</a></h1>
<p><em>The Machinery</em> is built around a plugin model. All features, even the built-in ones, are provided
through plugins. You can extend <em>The Machinery</em> by writing your own plugins.</p>
<p>When <em>The Machinery</em> launches, it loads all the plugins named <code>tm_*.dll</code> in its <code>plugins/</code> folder. If
you write your own plugins, name them so that they start with <code>tm_</code> and put them in this folder,
they will be loaded together with the built-in plugins.</p>
<p><em>The Machinery</em> is organized into individual APIs that can be called to perform specific tasks. A
plugin is a DLL that exposes one or several of these APIs. In order to implement its functionality,
the plugin may in turn rely on APIs exposed by other plugins.</p>
<p>A central object called the <a href="https://ourmachinery.com//apidoc/foundation/api_registry.h.html#structtm_api_registry_api">tm_api_registry_api</a> is used to keep track of all the APIs. When you want to use an API from another plugin, you ask the API registry for it. Similarly, you expose your APIs to the world by registering them with the
<a href="https://ourmachinery.com//apidoc/foundation/api_registry.h.html#structtm_api_registry_api">tm_api_registry_api</a>.</p>
<p>This may seem a bit abstract at this point, so let’s look at a concrete example, <a href="https://ourmachinery.com//apidoc/foundation/unicode.h.html#unicode.h">unicode.h</a> which exposes the
<a href="https://ourmachinery.com//apidoc/foundation/unicode.h.html#structtm_unicode_api">tm_unicode_api</a> for encoding an d decoding Unicode strings:</p>
<pre><code class="language-c">// This header has been abridged and commented from the original to make things
// clearer.

// Include standard header.
#include &quot;api_types.h&quot;

// Forward declarations.
struct tm_temp_allocator_i;

// Unicode helper functions.
struct tm_unicode_api
{
    // Encodes the `codepoint` as UTF-8 into `utf8` and returns a pointer to the
    // position where to insert the next codepoint. `utf8` should have room for at
    // least four bytes (the maximum size of a UTF-8 encoded codepoint).
    uint8_t *(*utf8_encode)(uint8_t *utf8, uint32_t codepoint);

    // Decodes and returns the first codepoint in the UTF-8 string `utf8`. The string
    // pointer is advanced to point to the next codepoint in the string. Will generate
    // an error message if the string is not a UTF-8 string.
    uint32_t (*utf8_decode)(const uint8_t **utf8);

    // ...
};

// Name of this API in the registry.
#define TM_UNICODE_API_NAME &quot;tm_unicode_api&quot;
</code></pre>
<p>Let’s go through this.</p>
<p>First, the code includes <a href="https://ourmachinery.com//apidoc/foundation/api_types.h.html#api_types.h">api_types.h</a>. This is a shared header with common type declarations. It includes things like <code>&lt;stdbool.h&gt;</code> and <code>&lt;stdint.h&gt;</code> and also defines a few <em>The Machinery</em> specific types, such as <a href="file:///C:/work/themachinery/build/doc/foundation/api_types.h.html#structtm_vec3_t">tm_vec3_t</a>.</p>
<p>In <em>The Machinery</em> we have a rule that header files can't include other header files (except for
<a href="https://ourmachinery.com//apidoc/foundation/api_types.h.html#api_types.h">api_types.h</a>). This helps keep compile times down, but it also simplifies the structure of the code. When you read a header file you don’t have to follow a long chain of other header files to understand what is happening.</p>
<p>Next follows a block of forward struct declarations (in this case only one).</p>
<p>Next we have the <a href="https://ourmachinery.com//apidoc/foundation/unicode.h.html#structtm_unicode_api">struct tm_unicode_api</a>  that defines the API, followed by the <a href="https://ourmachinery.com//apidoc/foundation/unicode.h.html#tm_unicode_api_name">TM_UNICODE_API_NAME</a>, the name of the API that other parts of the code can use to query for this API.</p>
<p>To use this API, you would first use the <a href="https://ourmachinery.com//apidoc/foundation/api_registry.h.html#structtm_api_registry_api">tm_api_registry_api</a> to query for the API pointer, then using that pointer, call the functions of the API:</p>
<pre><code class="language-c">struct tm_unicode_api *tm_unicode_api =
    (struct tm_unicode_api *)tm_global_api_registry-&gt;get(TM_UNICODE_API_NAME);

tm_unicode_api-&gt;utf8_encode(utf8, codepoint);
</code></pre>
<p>The different APIs that you can query for and use are documented in their respective header files, and in the <a href="https://ourmachinery.com/apidoc/apidoc.html">apidoc</a> (which is just extracted from the headers). Consult these files for information on how to use the various APIs that are available in <em>The Machinery.</em></p>
<p>In addition to APIs defined in header files, <em>The Machinery</em> also contains some header files with inline functions that you can include directly into your implementation files. For example <a href="https://ourmachinery.com//apidoc/foundation/math.inl.html#math.inl">math.inl</a> provides common
mathematical operations on vectors and matrices, while <a href="https://ourmachinery.com//apidoc/foundation/carray.inl.html#carray.inl">carray.inl</a> provides a “stretchy-buffer” implementation (i.e. a C version of C++’s <code>std::vector</code>).</p>
<h2 id="per-project-plugins"><a class="header" href="#per-project-plugins">Per project plugins</a></h2>
<p>The Engine supports per project plugins through <em>Plugin Assets</em>. A Plugin Asset is an asset in the
Asset Browser that holds a plugin.</p>
<p>To create a plugin asset in a particular project, just drop the <code>.dll</code> into the Asset Browser
(or use <strong>Import...</strong>). Every time you open the project, the plugin will be loaded.</p>
<blockquote>
<p><strong>Note</strong>: For security reasons, if you open a project containing plugins, you will be asked
whether you want to allow the plugins to run or not. Plugins aren't sandboxed, they have full
access to your machine. So you should only allow project plugins to run if you trust the author
of the plugin.</p>
</blockquote>
<p>When selecting a plugin asset in the asset browser the properties tab will show the following:</p>
<p><img src="https://ourmachinery.com/images/tutorials/plugin__properties.png" alt="" /></p>
<p>If you check the ☒ <strong>Import when changed</strong> checkbox, The Machinery will re-import and reload the
plugin every time it detects a change. You can use this to hot-reload your project plugins.</p>
<blockquote>
<p><strong>Note:</strong> since The Machinery APIs change with each release version, a plugin DLL built for one
specific version is unlikely to work with another version. Thus, to open a project with plugin
DLLs, you should make sure that your version matches the version the DLL was built for. In the
future, when The Machinery is out of beta, we will provide more stable APIs that will work across
multiple releases.</p>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="../extending_the_machinery/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="../extending_the_machinery/hot-reloading.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="../extending_the_machinery/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="../extending_the_machinery/hot-reloading.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
